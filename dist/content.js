(()=>{var j=null,G=()=>{if(j)return j;let t=document.querySelector('[aria-label*="Google Account"],[aria-label*="@gmail.com"],[aria-label*="@googlemail.com"],a[href*="accounts.google.com"][aria-label*="@"]');if(t){let n=(t.getAttribute("aria-label")||"").match(/[\w.-]+@[\w.-]+\.\w+/);if(n)return j=tt(n[0]),j}let e=document.querySelectorAll('[data-email],.gb_lb,[aria-label*="Signed in as"]');for(let o of e){let n=o.getAttribute("data-email")||o.textContent?.match(/[\w.-]+@[\w.-]+\.\w+/)?.[0];if(n)return j=tt(n),j}try{let o=document.querySelectorAll("script");for(let n of o){let s=(n.textContent||"").match(/"([\w.-]+@(?:gmail|googlemail)\.com)"/);if(s)return j=tt(s[1]),j}}catch{}return console.warn("[GCM] Could not detect Google account, using default namespace"),j="default",j},tt=t=>t.toLowerCase().replace(/[^a-z0-9@.]/g,"_");var rt=t=>{let e=j;j=null;let o=G();return o!==t&&o!=="default"?o:(j=e,null)};var N={PROJECTS:"gcm_projects",CHAT_MAPPINGS:"gcm_chat_mappings"},z={PROJECTS:"gcm_projects",CHAT_MAPPINGS:"gcm_chat_mappings"},J=t=>{let e=G();return e==="default"?t:`${t}_${e}`},K=()=>{try{return chrome.runtime?.id!==void 0}catch{return!1}},Nt=async t=>{if(!K()||t==="default")return;let e="gcm_legacy_migrated";try{let o=await chrome.storage.sync.get([e,z.PROJECTS,z.CHAT_MAPPINGS]);if(o[e])return;let n=o[z.PROJECTS],c=o[z.CHAT_MAPPINGS];if(!n&&!c){await chrome.storage.sync.set({[e]:!0});return}let s=`${N.PROJECTS}_${t}`,r=`${N.CHAT_MAPPINGS}_${t}`,d={[e]:!0};n&&(d[s]=n),c&&(d[r]=c),await chrome.storage.sync.set(d),await chrome.storage.sync.remove([z.PROJECTS,z.CHAT_MAPPINGS]),console.log("[GCM] Migrated legacy data to account:",t)}catch(o){console.warn("[GCM] Migration error:",o)}},it=async()=>{if(!K())return{projects:[],chatMappings:{}};let t=G();await Nt(t);let e=J(N.PROJECTS),o=J(N.CHAT_MAPPINGS);return new Promise(n=>{try{chrome.storage.sync.get([e,o],c=>{if(chrome.runtime.lastError){console.warn("[GCM] Storage read error:",chrome.runtime.lastError),n({projects:[],chatMappings:{}});return}n({projects:c[e]||[],chatMappings:c[o]||{}})})}catch{console.warn("[GCM] Extension context invalidated"),n({projects:[],chatMappings:{}})}})},q=t=>{if(!K())return Promise.resolve();let e=J(N.PROJECTS);try{return chrome.storage.sync.set({[e]:t})}catch{return console.warn("[GCM] Extension context invalidated"),Promise.resolve()}},S=t=>{if(!K())return Promise.resolve();let e=J(N.CHAT_MAPPINGS);try{return chrome.storage.sync.set({[e]:t})}catch{return console.warn("[GCM] Extension context invalidated"),Promise.resolve()}};var $={projects:[],chatMappings:{},lastClickedChatInfo:null,containerInjected:!1},I=()=>$.projects,L=()=>$.chatMappings,et=()=>$.lastClickedChatInfo;var P=t=>{$.projects=t},T=t=>{$.chatMappings=t},at=t=>{$.lastClickedChatInfo=t};var lt=()=>`p_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;var A=t=>{if(!t||typeof t!="string")return null;let e=t.trim();return e?e.startsWith("c_")?e:`c_${e}`:null},pt=(t={})=>{let e={};return Object.entries(t).forEach(([o,n])=>{let c=A(o);if(c){if(e[c]){e[c]={...e[c],...n};return}e[c]=n}}),e};var dt=t=>{if(!t)return null;let e=t.match(/c_[a-zA-Z0-9_-]{8,}/);return e?A(e[0]):null},mt=t=>{if(!t||typeof t!="string")return null;let e=t.split(/[?#]/)[0],o=e.match(/\/app\/([a-zA-Z0-9_-]+)/);return o||(o=e.match(/\/gem\/[^/]+\/([a-zA-Z0-9_-]+)/)),o||(o=e.match(/\/c\/([a-zA-Z0-9_-]+)/)),o?A(o[1]):null},ut=t=>{if(!t||typeof t!="string")return null;try{let e=new URL(t,window.location.origin);return mt(e.pathname)}catch{return mt(t)}},$t=t=>!t||typeof t!="string"?!1:t.includes("c_")?/c_[a-zA-Z0-9_-]{8,}/.test(t):/^[a-f0-9]{10,}$/i.test(t),Bt=t=>{if(!t)return null;let e=t.getAttribute("data-conversation-id")||t.getAttribute("data-chat-id")||t.dataset?.conversationId||t.dataset?.chatId;return $t(e)?A(e):null},M=t=>{if(!t)return null;let e=t.querySelector('[data-test-id="conversation"]'),o=[e,t];for(let i of o){let l=i?.getAttribute?.("jslog"),p=dt(l);if(p)return p;let v=Bt(i);if(v)return v}let n=t.querySelector("[jslog]"),c=dt(n?.getAttribute("jslog"));if(c)return c;let r=(e?.getAttribute?.("href")?e:e?.querySelector?.("a[href]")||t.querySelector("a[href]"))?.getAttribute?.("href"),d=ut(r);if(d)return d;let a=e?.getAttribute?.("data-href")||t.getAttribute?.("data-href");return ut(a)},Z=t=>{let e=A(t);if(!e)return null;let o=document.querySelectorAll(".conversation-items-container");for(let n of o){let c=M(n);if(c&&c===e)return n}return null},W=(t,e,o,n)=>{let c=L(),s=A(t);if(!s)return;s!==t&&delete c[t];let r=c[s];c[s]={projectId:o,title:e,addedAt:r?.addedAt||Date.now()},T(c),S(c),Rt(s),n&&n()},B=(t,e)=>{let o=L(),n=A(t);n&&delete o[n],t&&t!==n&&delete o[t],T(o),S(o),Ot(n||t),e&&e()},ht=t=>{let e=L(),o=A(t);if(!o||!e[o])return!1;let n=e[o].title||"Untitled";return delete e[o],t&&t!==o&&delete e[t],T(e),S(e),console.log(`[GCM] Chat "${n}" no longer exists - removed from project`),!0},Rt=t=>{let e=A(t);if(!e)return;document.querySelectorAll(".conversation-items-container").forEach(n=>{let c=M(n);c&&c===e&&(n.style.display="none",n.dataset.gcmHidden="true")})},Ot=t=>{let e=A(t);if(!e)return;document.querySelectorAll(".conversation-items-container").forEach(n=>{let c=M(n);c&&c===e&&(n.style.display="",delete n.dataset.gcmHidden)})},nt=()=>{let t=L(),e=new Set(Object.keys(t).map(n=>A(n)).filter(Boolean));document.querySelectorAll(".conversation-items-container").forEach(n=>{let c=M(n);c&&e.has(c)?(n.style.display!=="none"&&(n.style.display="none"),n.dataset.gcmHidden="true"):n.dataset.gcmHidden==="true"&&(n.style.display="",delete n.dataset.gcmHidden)})};var gt=()=>!1,ft=()=>{let t=window.location.pathname.match(/\/app\/([a-zA-Z0-9_-]+)/);return t||(t=window.location.pathname.match(/\/gem\/[^/]+\/([a-zA-Z0-9_-]+)/)),t||(t=window.location.pathname.match(/\/c\/([a-zA-Z0-9_-]+)/)),t?t[1]:null};var vt=t=>`/app/${t.startsWith("c_")?t.substring(2):t}`;var R=null,ot=()=>{R&&(R.remove(),R=null)},ct=(t,e,o)=>{ot();let n=document.createElement("div");n.classList.add("gcm-context-menu"),n.style.left=`${t}px`,n.style.top=`${e}px`,o.forEach(s=>{let r=document.createElement("button");r.classList.add("gcm-context-item"),s.danger&&r.classList.add("danger"),r.textContent=s.label,r.addEventListener("click",()=>{ot(),s.action()}),n.appendChild(r)}),document.body.appendChild(n),R=n;let c=n.getBoundingClientRect();c.right>window.innerWidth&&(n.style.left=`${window.innerWidth-c.width-8}px`),c.bottom>window.innerHeight&&(n.style.top=`${window.innerHeight-c.height-8}px`)},Ct=()=>{document.addEventListener("click",t=>{R&&!R.contains(t.target)&&ot()})};var yt=(t,e)=>{let o=I(),n={id:lt(),name:t,order:o.length,createdAt:Date.now()};o.push(n),P(o),q(o),e&&e()},xt=(t,e,o)=>{let n=I(),c=n.find(s=>s.id===t);c&&(c.name=e,P(n),q(n)),o&&o()},bt=(t,e)=>{let o=I(),n=L();o=o.filter(c=>c.id!==t),Object.keys(n).forEach(c=>{n[c]?.projectId===t&&delete n[c]}),P(o),T(n),q(o),S(n),e&&e()},wt=(t,e,o,n)=>{let c=I(),s=c.find(r=>r.id===t);s&&(s.gemId=e,s.gemName=o,P(c),q(c)),n&&n()},Y=(t,e,o)=>{let n=I(),c=n.find(s=>s.id===t);c&&(c.isExpanded=e,P(n),q(n)),o&&o()},Et=(t,e)=>{let o=I(),n=o.find(c=>c.id===t);n&&(delete n.gemId,delete n.gemName,P(o),q(o)),e&&e()},jt=t=>{let e=L(),o=[];Object.entries(e).forEach(([a,i])=>{i.projectId===t&&o.push({id:a,title:i.title,addedAt:i.addedAt||0,lastSeen:i.lastSeen})});let n=new Map,c=[],s=Date.now(),r=!1;document.querySelectorAll(".conversation-items-container").forEach(a=>{let i=M(a),l=a.querySelector(".conversation-title");if(i){let p=l?.textContent?.trim()||"Untitled";if(n.set(i,p),c.push(i),e[i]){let v=e[i].lastSeen||0;s-v>36e5&&(e[i].lastSeen=s,e[i].title=p,r=!0)}}}),r&&(T(e),S(e));let d=o.map(a=>{let i=n.get(a.id);return{...a,title:i||a.title,isLoaded:n.has(a.id)}});return d.sort((a,i)=>{if(a.isLoaded&&i.isLoaded){let v=c.indexOf(a.id),y=c.indexOf(i.id);return v-y}if(a.isLoaded&&!i.isLoaded)return-1;if(!a.isLoaded&&i.isLoaded)return 1;let l=a.addedAt||0;return(i.addedAt||0)-l}),d};var st=(t,e,o,n="")=>{let c=document.createElement("div");c.classList.add("gcm-modal-overlay");let s=document.createElement("div");s.classList.add("gcm-modal"),s.innerHTML=`
    <h3 class="gcm-modal-title">${t}</h3>
    <input type="text" class="gcm-modal-input" placeholder="${e}" value="${n}">
    <div class="gcm-modal-actions">
      <button class="gcm-modal-btn cancel">Cancel</button>
      <button class="gcm-modal-btn primary">Confirm</button>
    </div>
  `,c.appendChild(s),document.body.appendChild(c);let r=s.querySelector(".gcm-modal-input"),d=s.querySelector(".cancel"),a=s.querySelector(".primary");r.focus(),r.select();let i=()=>c.remove();d.addEventListener("click",i),c.addEventListener("click",l=>{l.target===c&&i()}),a.addEventListener("click",()=>{let l=r.value.trim();l&&(o(l),i())}),r.addEventListener("keydown",l=>{if(l.key==="Enter"){let p=r.value.trim();p&&(o(p),i())}else l.key==="Escape"&&i()})};var Ft=()=>{let t=[],e=new Set;return document.querySelectorAll("bot-list-item").forEach(o=>{let c=o.querySelector(".bot-name")?.textContent?.trim(),r=o.querySelector(".bot-item")?.getAttribute("jslog");if(r&&c){let d=r.match(/"([a-f0-9]{10,14})"/);d&&!e.has(d[1])&&(e.add(d[1]),t.push({id:d[1],name:c}))}}),t},Dt=t=>{let e=document.createElement("div");e.classList.add("gcm-modal-overlay");let o=Ft(),n="";o.length===0?n='<div class="gcm-empty">No Gems found. Make sure your Gems are visible in the sidebar.</div>':n=o.map(s=>`<div class="gcm-gem-item" data-gem-id="${s.id}" data-gem-name="${s.name}">${s.name}</div>`).join(""),e.innerHTML=`
    <div class="gcm-modal">
      <h3 class="gcm-modal-title">Select Gem</h3>
      <div class="gcm-gem-list">${n}</div>
      <div class="gcm-modal-actions">
        <button class="gcm-modal-btn cancel">Cancel</button>
      </div>
    </div>
  `,document.body.appendChild(e),e.querySelector(".cancel").addEventListener("click",()=>e.remove()),e.querySelectorAll(".gcm-gem-item").forEach(s=>{s.addEventListener("click",()=>{let r=s.dataset.gemId,d=s.dataset.gemName;t(r,d),e.remove()})}),e.addEventListener("click",s=>{s.target===e&&e.remove()})},Ut=()=>{let t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox","0 0 24 24"),t.classList.add("gcm-project-icon"),t.innerHTML='<path d="M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>',t},Vt=()=>{let t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("width","20"),t.setAttribute("height","20"),t.style.fill="currentColor",t.innerHTML='<path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',t},Jt=()=>document.querySelector('conversations-list[data-test-id="all-conversations"]'),Kt=t=>{let e=vt(t);!e||window.location.pathname===e||(window.history.pushState({},"",e),window.dispatchEvent(new PopStateEvent("popstate")))},Lt=!1,Mt=()=>Lt,It=!1,Zt=()=>{if(It)return;let t=document.querySelector(".gcm-project-header"),e=document.querySelector(".gcm-chat"),o=t?t.offsetHeight:0,n=e?e.offsetHeight:0;It=!0},C=()=>{let t=Jt();if(!t)return;let e=document.getElementById("gcm-container");e||(e=document.createElement("div"),e.id="gcm-container",e.classList.add("gcm-container"),t.insertBefore(e,t.firstChild),Lt=!0);let o=I(),n=ft();e.innerHTML=`
    <div class="gcm-header">
      <h2 class="gcm-title">Projects</h2>
      <button class="gcm-add-btn" id="gcm-add-project">+ Add</button>
    </div>
    <ul class="gcm-projects" id="gcm-projects-list"></ul>
  `;let c=e.querySelector("#gcm-projects-list");e.querySelector("#gcm-add-project").addEventListener("click",()=>{st("Create Project","Project name",r=>{yt(r,C)})}),o.length===0?c.innerHTML='<li class="gcm-empty">No projects yet. Click "+ Add" to create one.</li>':o.forEach(r=>{let d=jt(r.id),a=document.createElement("li");a.classList.add("gcm-project"),a.dataset.projectId=r.id,r.isExpanded&&a.classList.add("expanded");let i=document.createElement("div");i.classList.add("gcm-project-header"),i.appendChild(Ut());let l=document.createElement("button");l.classList.add("gcm-expand-btn"),l.innerHTML=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
            </svg>`,l.addEventListener("click",m=>{m.stopPropagation(),a.classList.toggle("expanded"),Y(r.id,a.classList.contains("expanded"))}),i.appendChild(l);let p=document.createElement("span");p.classList.add("gcm-project-name"),p.textContent=r.name,i.appendChild(p);let v=document.createElement("span");v.classList.add("gcm-project-count"),v.textContent=d.length,i.appendChild(v);let y=document.createElement("button");y.classList.add("gcm-project-menu-btn"),y.appendChild(Vt()),y.addEventListener("click",m=>{m.stopPropagation();let u=[{label:r.gemId?"Change Gem":"Set Gem",action:()=>{Dt((h,E)=>{wt(r.id,h,E,C)})}}];r.gemId&&u.push({label:"Clear Gem",action:()=>Et(r.id,C)}),u.push({label:"Rename",action:()=>st("Rename Project","New name",h=>{xt(r.id,h,C)},r.name)},{label:"Delete",danger:!0,action:()=>{confirm(`Delete "${r.name}"? Chats will not be deleted.`)&&bt(r.id,C)}}),ct(m.clientX,m.clientY,u)}),i.appendChild(y),i.addEventListener("click",()=>{if(r.gemId){let m=!1;document.querySelectorAll("bot-list-item .bot-item").forEach(u=>{let h=u.getAttribute("jslog");if(h&&h.includes(r.gemId)){let E=u.querySelector("button.bot-new-conversation-button");E&&(E.click(),m=!0)}}),m||(a.classList.toggle("expanded"),Y(r.id,a.classList.contains("expanded")))}else a.classList.toggle("expanded"),Y(r.id,a.classList.contains("expanded"))}),a.appendChild(i);let g=document.createElement("ul");if(g.classList.add("gcm-chats"),d.length===0){let m=document.createElement("li");m.classList.add("gcm-empty"),m.textContent="No chats in this project",g.appendChild(m)}else d.forEach(m=>{let u=document.createElement("li");u.classList.add("gcm-chat"),n&&(m.id===n||m.id===`c_${n}`||m.id.substring(2)===n)&&u.classList.add("active");let E=document.createElement("span");E.classList.add("gcm-chat-title"),E.textContent=m.title,u.appendChild(E);let k=document.createElement("button");k.classList.add("gcm-chat-menu-btn"),k.innerHTML=`<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
          </svg>`,k.addEventListener("click",b=>{b.stopPropagation();let x=f=>{let w=Z(m.id),_=w?.querySelector(".conversation-actions-menu-button");if(_&&w){let H=[document.querySelector('[data-test-id="overflow-container"]'),document.querySelector(".overflow-container"),document.querySelector("infinite-scroller")].filter(Boolean),X=H.map(F=>F.scrollTop),O=document.createElement("style");return O.id="gcm-hide-native-menu",O.textContent=`
                                    .cdk-overlay-container { opacity: 0 !important; pointer-events: none !important; }
                                    .conversation-items-container[data-gcm-hidden="true"] { 
                                        visibility: visible !important;
                                        opacity: 0 !important; 
                                        pointer-events: auto !important;
                                        position: fixed !important;
                                        top: -9999px !important;
                                        left: -9999px !important;
                                        width: 1px !important;
                                        height: 1px !important;
                                        clip: rect(0, 0, 0, 0) !important;
                                        overflow: hidden !important;
                                    }
                                `,document.head.appendChild(O),_.click(),H.forEach((F,Q)=>{F.scrollTop=X[Q]}),setTimeout(()=>{let F=document.querySelectorAll('.mat-mdc-menu-panel [role="menuitem"]'),Q=!1;F.forEach(V=>{if(V.textContent?.trim().toLowerCase().includes(f.toLowerCase())&&(O.remove(),V.click(),Q=!0,f.toLowerCase()==="delete")){let D=()=>{Z(m.id)||(B(m.id,C),window.location.pathname!=="/app"&&(window.history.pushState({},"","/app"),window.dispatchEvent(new PopStateEvent("popstate"))))};setTimeout(D,1e3),setTimeout(D,2e3),setTimeout(D,3e3)}}),document.getElementById("gcm-hide-native-menu")&&document.getElementById("gcm-hide-native-menu").remove(),H.forEach((V,D)=>{V.scrollTop=X[D]})},100),!0}return!1};ct(b.clientX,b.clientY,[{label:"Share conversation",action:()=>x("share")},{label:"Pin",action:()=>x("pin")},{label:"Rename",action:()=>x("rename")},{label:"Remove from Project",danger:!0,action:()=>B(m.id,C)},{label:"Delete",danger:!0,action:()=>{x("delete")||B(m.id,C)}}])}),u.appendChild(k),u.addEventListener("click",b=>{if(b.target.closest(".gcm-chat-menu-btn"))return;let x=Z(m.id),w=x?.querySelector('[data-test-id="conversation"]')||x?.querySelector('[role="button"]')||x;w?(x&&(x.style.display=""),w.click(),setTimeout(()=>{x&&(x.style.display="none")},100)):Kt(m.id)}),g.appendChild(u)});a.appendChild(g),c.appendChild(a)}),requestAnimationFrame(Zt)};var At="gcm-move-to-project-item",Wt=t=>{if(t.querySelector(`#${At}`))return;let e=I(),o=et(),n=L();if(!o)return;let c=t.querySelectorAll('[role="menuitem"], .mat-mdc-menu-item, button.mdc-list-item');if(c.length===0)return;let s=Array.from(c).map(y=>y.textContent?.toLowerCase()||"").join(" ");if(!(s.includes("delete")||s.includes("share")||s.includes("pin")||s.includes("rename")))return;let a=!!n[o.id]?.projectId,i=c[c.length-1],l=document.createElement("button");l.id=At,l.setAttribute("role","menuitem"),l.className="mat-mdc-menu-item mat-mdc-focus-indicator mdc-list-item gcm-move-item",l.style.cssText=`
    position: relative;
    padding: 0 16px;
    height: 48px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
    color: ${a?"#f28b82":"#e3e3e3"};
    background: transparent;
    border: none;
    width: 100%;
    text-align: left;
    font-family: inherit;
  `;let p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("width","20"),p.setAttribute("height","20"),p.style.fill=a?"#f28b82":"#e3e3e3",p.innerHTML='<path d="M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>';let v=document.createElement("span");if(v.textContent=a?"Remove from Project":"Move to Project",v.style.flex="1",l.appendChild(p),l.appendChild(v),a)l.addEventListener("click",y=>{y.stopPropagation(),B(o.id,C),document.body.click()}),l.addEventListener("mouseenter",()=>{l.style.background="rgba(255, 255, 255, 0.08)"}),l.addEventListener("mouseleave",()=>{l.style.background=""});else{let y=document.createElement("span");y.textContent="\u203A",y.style.cssText="font-size: 16px; color: #9aa0a6;",l.appendChild(y);let g=document.createElement("div");if(g.classList.add("gcm-native-submenu"),g.style.cssText=`
      position: fixed;
      background: #202124;
      border-radius: 4px;
      padding: 0;
      min-width: 160px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3), 0 4px 8px 3px rgba(0,0,0,0.15);
      display: none;
      z-index: 10002;
      font-family: "Google Sans", Roboto, sans-serif;
      overflow: hidden;
    `,e.length===0){let u=document.createElement("div");u.style.cssText="padding: 12px 16px; color: #9aa0a6; font-size: 14px;",u.textContent="No projects yet",g.appendChild(u)}else e.forEach(u=>{let h=document.createElement("div");h.style.cssText=`
          padding: 12px 16px;
          cursor: pointer;
          font-size: 14px;
          color: #e8eaed;
          font-family: "Google Sans", Roboto, sans-serif;
          transition: background 0.1s;
        `,h.textContent=u.name,h.addEventListener("mouseenter",()=>{h.style.background="rgba(255, 255, 255, 0.1)"}),h.addEventListener("mouseleave",()=>{h.style.background=""}),h.addEventListener("click",E=>{if(E.stopPropagation(),o){W(o.id,o.title,u.id,C),g.remove(),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape",keyCode:27,bubbles:!0}));let k=document.querySelector(".cdk-overlay-backdrop");k&&k.click(),document.querySelectorAll(".mat-mdc-menu-panel").forEach(b=>{b.remove()}),document.querySelectorAll(".cdk-overlay-pane").forEach(b=>{b.querySelector(".mat-mdc-menu-panel")&&b.remove()})}}),g.appendChild(h)});document.body.appendChild(g),l.addEventListener("mouseenter",()=>{l.style.background="rgba(255, 255, 255, 0.08)";let u=l.getBoundingClientRect();g.style.left=`${u.right}px`,g.style.top=`${u.top}px`,g.style.display="block";let h=g.getBoundingClientRect();h.right>window.innerWidth&&(g.style.left=`${u.left-h.width}px`),h.bottom>window.innerHeight&&(g.style.top=`${window.innerHeight-h.height-8}px`)}),l.addEventListener("mouseleave",u=>{let h=u.relatedTarget;g.contains(h)||(l.style.background="",g.style.display="none")}),g.addEventListener("mouseleave",()=>{l.style.background="",g.style.display="none"});let m=()=>{document.body.contains(t)||(g.remove(),document.removeEventListener("click",m))};setTimeout(()=>document.addEventListener("click",m),100)}i&&i.parentElement&&i.parentElement.insertBefore(l,i)},St=()=>{let t=["projects","chats","gemini","recent","starred","untitled"];document.addEventListener("click",e=>{let o=e.target.closest(".conversation-actions-menu-button")||e.target.closest('[data-test-id="actions-menu-button"]')||e.target.closest('button[aria-haspopup="menu"]');if(o){let n=o.closest(".conversation-items-container");if(n){let s=n.querySelector(".conversation-title")?.textContent?.trim()||"Untitled Chat",r=M(n),d=s&&!t.includes(s.toLowerCase());r&&d&&at({id:r,title:s})}}},!0)},Pt=()=>{new MutationObserver(e=>{for(let o of e)for(let n of o.addedNodes){if(n.nodeType!==Node.ELEMENT_NODE)continue;let s=n.classList?.contains("cdk-overlay-pane")?n.querySelector(".mat-mdc-menu-panel"):null,r=n.classList?.contains("mat-mdc-menu-panel"),d=s||(r?n:null);d&&et()&&setTimeout(()=>Wt(d),50)}}).observe(document.body,{childList:!0,subtree:!0})};var U=new Set,Tt=!1,qt=null,Ht=()=>{let t=window.location.pathname.match(/\/gem\/([^/?]+)/);return t?t[1]:null},Gt=t=>I().find(o=>o.gemId===t),kt=t=>t.querySelector(".conversation-title")?.textContent?.trim()||"Untitled Chat",Yt=()=>{Tt||(document.querySelectorAll(".conversation-items-container").forEach(t=>{let e=M(t);e&&U.add(e)}),Tt=!0)},_t=t=>{let e=M(t);if(!e)return;if(L()[e]){U.add(e);return}if(U.has(e))return;U.add(e);let n=Ht();if(!n)return;let c=Gt(n);if(!c)return;let s=kt(t);setTimeout(()=>{let r=M(t)||e,d=kt(t)||s;W(r,d,c.id,qt),U.add(r)},150)},zt=t=>{qt=t,setTimeout(Yt,1e3),new MutationObserver(o=>{let n=Ht();!n||!Gt(n)||o.forEach(s=>{s.addedNodes.forEach(r=>{r.nodeType===Node.ELEMENT_NODE&&(r.classList?.contains("conversation-items-container")&&_t(r),r.querySelectorAll?.(".conversation-items-container").forEach(d=>{_t(d)}))})})}).observe(document.body,{childList:!0,subtree:!0})};var Xt="1.2.0";console.log(`[GCM] Gemini Chat Manager v${Xt} loaded`);var Qt=()=>document.querySelector('conversations-list[data-test-id="all-conversations"]'),te=async()=>{let t=["projects","chats","gemini","recent","starred","untitled","untitled chat"],e=G(),o=await it();P(o.projects);let n=pt(o.chatMappings),c=new Set(o.projects.map(a=>a.id)),s={};Object.entries(n).forEach(([a,i])=>{let l=i?.projectId&&c.has(i.projectId),p=i?.title&&!t.includes(i.title.toLowerCase());l&&p&&(s[a]=i)}),T(s),S(s),Ct(),St(),Pt();let r=0,d=setInterval(()=>{r++;let a=Qt();if((a||r>60)&&(clearInterval(d),a)){C();let i=null,l=(f,w)=>()=>{i&&clearTimeout(i),i=setTimeout(f,w)},p=!1,v=()=>{let f=document.getElementById("gcm-container");return f?f.matches(":hover"):!1},y=()=>{if(v()){if(p)return;p=!0;let f=()=>{if(!v()){p=!1,C();return}setTimeout(f,150)};setTimeout(f,150);return}p=!1,C()},g=l(()=>{nt()},300),m=l(()=>{y()},200),u=e,h=0,E=()=>{let f=Date.now();if(f-h<2e3)return;h=f;let w=rt(u);w&&(console.log(`[GCM] Account changed from ${u} to ${w}, reloading...`),u=w,window.location.reload())};new MutationObserver(()=>{(!Mt()||!document.getElementById("gcm-container"))&&m(),g(),E()}).observe(document.body,{childList:!0,subtree:!0}),setTimeout(nt,500),zt(m),setInterval(()=>{gt()&&m()},1e4);let b=window.location.href,x=null;setInterval(()=>{let f=window.location.href;if(f!==b){let w=b.match(/\/app\/([a-zA-Z0-9_-]+)/),_=w?`c_${w[1]}`:null;_&&x===_&&f.includes("/app")&&!f.includes(_.substring(2))&&ht(_)&&setTimeout(()=>C(),100);let H=f.match(/\/app\/([a-zA-Z0-9_-]+)/);x=H?`c_${H[1]}`:null,b=f,C(),E()}},200),setInterval(()=>{m()},3e3)}},500)};te();})();
