(()=>{var I=null,$=()=>{if(I)return I;let t=document.querySelector('[aria-label*="Google Account"],[aria-label*="@gmail.com"],[aria-label*="@googlemail.com"],a[href*="accounts.google.com"][aria-label*="@"]');if(t){let n=(t.getAttribute("aria-label")||"").match(/[\w.-]+@[\w.-]+\.\w+/);if(n)return I=X(n[0]),I}let e=document.querySelectorAll('[data-email],.gb_lb,[aria-label*="Signed in as"]');for(let o of e){let n=o.getAttribute("data-email")||o.textContent?.match(/[\w.-]+@[\w.-]+\.\w+/)?.[0];if(n)return I=X(n),I}try{let o=document.querySelectorAll("script");for(let n of o){let r=(n.textContent||"").match(/"([\w.-]+@(?:gmail|googlemail)\.com)"/);if(r)return I=X(r[1]),I}}catch{}return console.warn("[GCM] Could not detect Google account, using default namespace"),I="default",I},X=t=>t.toLowerCase().replace(/[^a-z0-9@.]/g,"_");var k={PROJECTS:"gcm_projects",CHAT_MAPPINGS:"gcm_chat_mappings"},D={PROJECTS:"gcm_projects",CHAT_MAPPINGS:"gcm_chat_mappings"},U=t=>{let e=$();return e==="default"?t:`${t}_${e}`},V=()=>{try{return chrome.runtime?.id!==void 0}catch{return!1}},$t=async t=>{if(!V()||t==="default")return;let e=`gcm_migrated_${t}`;try{let o=await chrome.storage.sync.get([e,D.PROJECTS,D.CHAT_MAPPINGS]);if(o[e])return;let n=o[D.PROJECTS],c=o[D.CHAT_MAPPINGS];if(!n&&!c){await chrome.storage.sync.set({[e]:!0});return}let r=`${k.PROJECTS}_${t}`,s=`${k.CHAT_MAPPINGS}_${t}`,i={[e]:!0};n&&(i[r]=n),c&&(i[s]=c),await chrome.storage.sync.set(i),console.log("[GCM] Migrated legacy data to account:",t)}catch(o){console.warn("[GCM] Migration error:",o)}},it=async()=>{if(!V())return{projects:[],chatMappings:{}};let t=$();await $t(t);let e=U(k.PROJECTS),o=U(k.CHAT_MAPPINGS);return new Promise(n=>{try{chrome.storage.sync.get([e,o],c=>{if(chrome.runtime.lastError){console.warn("[GCM] Storage read error:",chrome.runtime.lastError),n({projects:[],chatMappings:{}});return}n({projects:c[e]||[],chatMappings:c[o]||{}})})}catch{console.warn("[GCM] Extension context invalidated"),n({projects:[],chatMappings:{}})}})},T=t=>{if(!V())return Promise.resolve();let e=U(k.PROJECTS);try{return chrome.storage.sync.set({[e]:t})}catch{return console.warn("[GCM] Extension context invalidated"),Promise.resolve()}},S=t=>{if(!V())return Promise.resolve();let e=U(k.CHAT_MAPPINGS);try{return chrome.storage.sync.set({[e]:t})}catch{return console.warn("[GCM] Extension context invalidated"),Promise.resolve()}};var q={projects:[],chatMappings:{},lastClickedChatInfo:null,containerInjected:!1},x=()=>q.projects,b=()=>q.chatMappings,Q=()=>q.lastClickedChatInfo;var P=t=>{q.projects=t},A=t=>{q.chatMappings=t},at=t=>{q.lastClickedChatInfo=t};var dt=()=>`p_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;var j=t=>{if(!t||typeof t!="string")return null;let e=t.trim();return e?e.startsWith("c_")?e:`c_${e}`:null},pt=(t={})=>{let e={};return Object.entries(t).forEach(([o,n])=>{let c=j(o);if(c){if(e[c]){e[c]={...e[c],...n};return}e[c]=n}}),e},gt=t=>{if(!t||typeof t!="string")return"";let e=t.replace(/\s+/g," ").trim();if(!e)return"";let o=e.toLowerCase();return o==="gemini"||o==="chats"?"":e},Bt=()=>{let t=document.title||"";if(!t)return"";let e=t.replace(/\s*[-|]\s*gemini.*$/i,"").trim();return gt(e)},Ot=()=>{let t=['main [data-test-id="conversation-title"]','main [data-test-id="conversation-title-text"]','main [data-test-id="chat-title"]',"main h1","main h2",'[data-test-id="conversation-title"]','[data-test-id="conversation-title-text"]','[data-test-id="chat-title"]'];for(let e of t){let o=document.querySelector(e),n=gt(o?.textContent);if(n)return n}return Bt()},lt=t=>{if(!t)return null;let e=t.match(/c_[a-zA-Z0-9_-]{8,}/);return e?j(e[0]):null},mt=t=>{if(!t||typeof t!="string")return null;let e=t.split(/[?#]/)[0],o=e.match(/\/app\/([a-zA-Z0-9_-]+)/);return o||(o=e.match(/\/gem\/[^/]+\/([a-zA-Z0-9_-]+)/)),o||(o=e.match(/\/c\/([a-zA-Z0-9_-]+)/)),o?j(o[1]):null},ut=t=>{if(!t||typeof t!="string")return null;try{let e=new URL(t,window.location.origin);return mt(e.pathname)}catch{return mt(t)}},Rt=t=>!t||typeof t!="string"?!1:t.includes("c_")?/c_[a-zA-Z0-9_-]{8,}/.test(t):/^[a-f0-9]{10,}$/i.test(t),Ft=t=>{if(!t)return null;let e=t.getAttribute("data-conversation-id")||t.getAttribute("data-chat-id")||t.dataset?.conversationId||t.dataset?.chatId;return Rt(e)?j(e):null},E=t=>{if(!t)return null;let e=t.querySelector('[data-test-id="conversation"]'),o=[e,t];for(let d of o){let a=d?.getAttribute?.("jslog"),g=lt(a);if(g)return g;let y=Ft(d);if(y)return y}let n=t.querySelector("[jslog]"),c=lt(n?.getAttribute("jslog"));if(c)return c;let s=(e?.getAttribute?.("href")?e:e?.querySelector?.("a[href]")||t.querySelector("a[href]"))?.getAttribute?.("href"),i=ut(s);if(i)return i;let m=e?.getAttribute?.("data-href")||t.getAttribute?.("data-href");return ut(m)},J=t=>{let e=j(t);if(!e)return null;let o=document.querySelectorAll(".conversation-items-container");for(let n of o){let c=E(n);if(c&&c===e)return n}return null},K=(t,e,o,n)=>{let c=b(),r=j(t);if(!r)return;r!==t&&delete c[t];let s=c[r];c[r]={projectId:o,title:e,addedAt:s?.addedAt||Date.now()},A(c),S(c),Dt(r),n&&n()},_=(t,e)=>{let o=b(),n=j(t);n&&delete o[n],t&&t!==n&&delete o[t],A(o),S(o),Ut(n||t),e&&e()},Dt=t=>{let e=j(t);if(!e)return;document.querySelectorAll(".conversation-items-container").forEach(n=>{let c=E(n);c&&c===e&&(n.style.display="none",n.dataset.gcmHidden="true")})},Ut=t=>{let e=j(t);if(!e)return;document.querySelectorAll(".conversation-items-container").forEach(n=>{let c=E(n);c&&c===e&&(n.style.display="",delete n.dataset.gcmHidden)})},tt=()=>{let t=b(),e=new Set(Object.keys(t).map(n=>j(n)).filter(Boolean));document.querySelectorAll(".conversation-items-container").forEach(n=>{let c=E(n);c&&e.has(c)?(n.style.display!=="none"&&(n.style.display="none"),n.dataset.gcmHidden="true"):n.dataset.gcmHidden==="true"&&(n.style.display="",delete n.dataset.gcmHidden)})},ht=()=>{let t=b(),e=new Set(Object.keys(t).map(n=>j(n)).filter(Boolean));document.querySelectorAll(".conversation-items-container").forEach(n=>{let c=E(n);c&&!e.has(c)&&n.style.display==="none"&&(n.style.display="",delete n.dataset.gcmHidden)})},ft=()=>!1,et=()=>{let t=window.location.pathname.match(/\/app\/([a-zA-Z0-9_-]+)/);return t||(t=window.location.pathname.match(/\/gem\/[^/]+\/([a-zA-Z0-9_-]+)/)),t||(t=window.location.pathname.match(/\/c\/([a-zA-Z0-9_-]+)/)),t?t[1]:null},vt=()=>{let t=["projects","chats","gemini","recent","starred","untitled","untitled chat"],e=et(),o=j(e);if(!o)return!1;let n=Ot();if(!n||t.includes(n.toLowerCase()))return!1;let c=b(),r=c[o];return r&&r.title!==n?(c[o]={...r,title:n},A(c),S(c),!0):!1},Ct=t=>`/app/${t.startsWith("c_")?t.substring(2):t}`;var H=null,nt=()=>{H&&(H.remove(),H=null)},ot=(t,e,o)=>{nt();let n=document.createElement("div");n.classList.add("gcm-context-menu"),n.style.left=`${t}px`,n.style.top=`${e}px`,o.forEach(r=>{let s=document.createElement("button");s.classList.add("gcm-context-item"),r.danger&&s.classList.add("danger"),s.textContent=r.label,s.addEventListener("click",()=>{nt(),r.action()}),n.appendChild(s)}),document.body.appendChild(n),H=n;let c=n.getBoundingClientRect();c.right>window.innerWidth&&(n.style.left=`${window.innerWidth-c.width-8}px`),c.bottom>window.innerHeight&&(n.style.top=`${window.innerHeight-c.height-8}px`)},yt=()=>{document.addEventListener("click",t=>{H&&!H.contains(t.target)&&nt()})};var xt=(t,e)=>{let o=x(),n={id:dt(),name:t,order:o.length,createdAt:Date.now()};o.push(n),P(o),T(o),e&&e()},bt=(t,e,o)=>{let n=x(),c=n.find(r=>r.id===t);c&&(c.name=e,P(n),T(n)),o&&o()},Et=(t,e)=>{let o=x(),n=b();o=o.filter(c=>c.id!==t),Object.keys(n).forEach(c=>{n[c]?.projectId===t&&delete n[c]}),P(o),A(n),T(o),S(n),e&&e()},wt=(t,e,o,n)=>{let c=x(),r=c.find(s=>s.id===t);r&&(r.gemId=e,r.gemName=o,P(c),T(c)),n&&n()},Z=(t,e,o)=>{let n=x(),c=n.find(r=>r.id===t);c&&(c.isExpanded=e,P(n),T(n)),o&&o()},jt=(t,e)=>{let o=x(),n=o.find(c=>c.id===t);n&&(delete n.gemId,delete n.gemName,P(o),T(o)),e&&e()},Lt=t=>{let e=b(),o=[];Object.entries(e).forEach(([s,i])=>{i.projectId===t&&o.push({id:s,title:i.title,addedAt:i.addedAt||0})});let n=new Map,c=[];document.querySelectorAll(".conversation-items-container").forEach(s=>{let i=E(s),m=s.querySelector(".conversation-title");if(i){let d=m?.textContent?.trim()||"Untitled";n.set(i,d),c.push(i)}});let r=o.map(s=>{let i=n.get(s.id);return{...s,title:i||s.title,isLoaded:n.has(s.id)}});return r.sort((s,i)=>{if(s.isLoaded&&i.isLoaded){let a=c.indexOf(s.id),g=c.indexOf(i.id);return a-g}if(s.isLoaded&&!i.isLoaded)return-1;if(!s.isLoaded&&i.isLoaded)return 1;let m=s.addedAt||0;return(i.addedAt||0)-m}),r};var ct=(t,e,o,n="")=>{let c=document.createElement("div");c.classList.add("gcm-modal-overlay");let r=document.createElement("div");r.classList.add("gcm-modal"),r.innerHTML=`
    <h3 class="gcm-modal-title">${t}</h3>
    <input type="text" class="gcm-modal-input" placeholder="${e}" value="${n}">
    <div class="gcm-modal-actions">
      <button class="gcm-modal-btn cancel">Cancel</button>
      <button class="gcm-modal-btn primary">Confirm</button>
    </div>
  `,c.appendChild(r),document.body.appendChild(c);let s=r.querySelector(".gcm-modal-input"),i=r.querySelector(".cancel"),m=r.querySelector(".primary");s.focus(),s.select();let d=()=>c.remove();i.addEventListener("click",d),c.addEventListener("click",a=>{a.target===c&&d()}),m.addEventListener("click",()=>{let a=s.value.trim();a&&(o(a),d())}),s.addEventListener("keydown",a=>{if(a.key==="Enter"){let g=s.value.trim();g&&(o(g),d())}else a.key==="Escape"&&d()})};var Vt=()=>{let t=[],e=new Set;return document.querySelectorAll("bot-list-item").forEach(o=>{let c=o.querySelector(".bot-name")?.textContent?.trim(),s=o.querySelector(".bot-item")?.getAttribute("jslog");if(s&&c){let i=s.match(/"([a-f0-9]{10,14})"/);i&&!e.has(i[1])&&(e.add(i[1]),t.push({id:i[1],name:c}))}}),t},Jt=t=>{let e=document.createElement("div");e.classList.add("gcm-modal-overlay");let o=Vt(),n="";o.length===0?n='<div class="gcm-empty">No Gems found. Make sure your Gems are visible in the sidebar.</div>':n=o.map(r=>`<div class="gcm-gem-item" data-gem-id="${r.id}" data-gem-name="${r.name}">${r.name}</div>`).join(""),e.innerHTML=`
    <div class="gcm-modal">
      <h3 class="gcm-modal-title">Select Gem</h3>
      <div class="gcm-gem-list">${n}</div>
      <div class="gcm-modal-actions">
        <button class="gcm-modal-btn cancel">Cancel</button>
      </div>
    </div>
  `,document.body.appendChild(e),e.querySelector(".cancel").addEventListener("click",()=>e.remove()),e.querySelectorAll(".gcm-gem-item").forEach(r=>{r.addEventListener("click",()=>{let s=r.dataset.gemId,i=r.dataset.gemName;t(s,i),e.remove()})}),e.addEventListener("click",r=>{r.target===e&&e.remove()})},Kt=()=>{let t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox","0 0 24 24"),t.classList.add("gcm-project-icon"),t.innerHTML='<path d="M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>',t},Zt=()=>{let t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("width","20"),t.setAttribute("height","20"),t.style.fill="currentColor",t.innerHTML='<path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',t},Wt=()=>document.querySelector('conversations-list[data-test-id="all-conversations"]'),Yt=t=>{let e=Ct(t);!e||window.location.pathname===e||(window.history.pushState({},"",e),window.dispatchEvent(new PopStateEvent("popstate")))},Mt=!1,Pt=()=>Mt,It=!1,Xt=()=>{if(It)return;let t=document.querySelector(".gcm-project-header"),e=document.querySelector(".gcm-chat"),o=t?t.offsetHeight:0,n=e?e.offsetHeight:0;It=!0},v=()=>{let t=Wt();if(!t)return;let e=document.getElementById("gcm-container");e||(e=document.createElement("div"),e.id="gcm-container",e.classList.add("gcm-container"),t.insertBefore(e,t.firstChild),Mt=!0);let o=x(),n=et();e.innerHTML=`
    <div class="gcm-header">
      <h2 class="gcm-title">Projects</h2>
      <button class="gcm-add-btn" id="gcm-add-project">+ Add</button>
    </div>
    <ul class="gcm-projects" id="gcm-projects-list"></ul>
  `;let c=e.querySelector("#gcm-projects-list");e.querySelector("#gcm-add-project").addEventListener("click",()=>{ct("Create Project","Project name",s=>{xt(s,v)})}),o.length===0?c.innerHTML='<li class="gcm-empty">No projects yet. Click "+ Add" to create one.</li>':o.forEach(s=>{let i=Lt(s.id),m=document.createElement("li");m.classList.add("gcm-project"),m.dataset.projectId=s.id,s.isExpanded&&m.classList.add("expanded");let d=document.createElement("div");d.classList.add("gcm-project-header"),d.appendChild(Kt());let a=document.createElement("button");a.classList.add("gcm-expand-btn"),a.innerHTML=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
            </svg>`,a.addEventListener("click",l=>{l.stopPropagation(),m.classList.toggle("expanded"),Z(s.id,m.classList.contains("expanded"))}),d.appendChild(a);let g=document.createElement("span");g.classList.add("gcm-project-name"),g.textContent=s.name,d.appendChild(g);let y=document.createElement("span");y.classList.add("gcm-project-count"),y.textContent=i.length,d.appendChild(y);let C=document.createElement("button");C.classList.add("gcm-project-menu-btn"),C.appendChild(Zt()),C.addEventListener("click",l=>{l.stopPropagation();let u=[{label:s.gemId?"Change Gem":"Set Gem",action:()=>{Jt((p,f)=>{wt(s.id,p,f,v)})}}];s.gemId&&u.push({label:"Clear Gem",action:()=>jt(s.id,v)}),u.push({label:"Rename",action:()=>ct("Rename Project","New name",p=>{bt(s.id,p,v)},s.name)},{label:"Delete",danger:!0,action:()=>{confirm(`Delete "${s.name}"? Chats will not be deleted.`)&&Et(s.id,v)}}),ot(l.clientX,l.clientY,u)}),d.appendChild(C),d.addEventListener("click",()=>{if(s.gemId){let l=!1;document.querySelectorAll("bot-list-item .bot-item").forEach(u=>{let p=u.getAttribute("jslog");if(p&&p.includes(s.gemId)){let f=u.querySelector("button.bot-new-conversation-button");f&&(f.click(),l=!0)}}),l||(m.classList.toggle("expanded"),Z(s.id,m.classList.contains("expanded")))}else m.classList.toggle("expanded"),Z(s.id,m.classList.contains("expanded"))}),m.appendChild(d);let h=document.createElement("ul");if(h.classList.add("gcm-chats"),i.length===0){let l=document.createElement("li");l.classList.add("gcm-empty"),l.textContent="No chats in this project",h.appendChild(l)}else i.forEach(l=>{let u=document.createElement("li");u.classList.add("gcm-chat"),n&&(l.id===n||l.id===`c_${n}`||l.id.substring(2)===n)&&u.classList.add("active");let f=document.createElement("span");f.classList.add("gcm-chat-title"),f.textContent=l.title,u.appendChild(f);let M=document.createElement("button");M.classList.add("gcm-chat-menu-btn"),M.innerHTML=`<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
          </svg>`,M.addEventListener("click",L=>{L.stopPropagation();let w=O=>{let G=J(l.id),st=G?.querySelector(".conversation-actions-menu-button");if(st&&G){let W=[document.querySelector('[data-test-id="overflow-container"]'),document.querySelector(".overflow-container"),document.querySelector("infinite-scroller")].filter(Boolean),rt=W.map(z=>z.scrollTop),R=document.createElement("style");return R.id="gcm-hide-native-menu",R.textContent=`
                                    .cdk-overlay-container { opacity: 0 !important; pointer-events: none !important; }
                                    .conversation-items-container[data-gcm-hidden="true"] { 
                                        visibility: visible !important;
                                        opacity: 0 !important; 
                                        pointer-events: auto !important;
                                        position: fixed !important;
                                        top: -9999px !important;
                                        left: -9999px !important;
                                        width: 1px !important;
                                        height: 1px !important;
                                        clip: rect(0, 0, 0, 0) !important;
                                        overflow: hidden !important;
                                    }
                                `,document.head.appendChild(R),st.click(),W.forEach((z,Y)=>{z.scrollTop=rt[Y]}),setTimeout(()=>{let z=document.querySelectorAll('.mat-mdc-menu-panel [role="menuitem"]'),Y=!1;z.forEach(F=>{if(F.textContent?.trim().toLowerCase().includes(O.toLowerCase())&&(R.remove(),F.click(),Y=!0,O.toLowerCase()==="delete")){let N=()=>{J(l.id)||(_(l.id,v),window.location.pathname!=="/app"&&(window.history.pushState({},"","/app"),window.dispatchEvent(new PopStateEvent("popstate"))))};setTimeout(N,1e3),setTimeout(N,2e3),setTimeout(N,3e3)}}),document.getElementById("gcm-hide-native-menu")&&document.getElementById("gcm-hide-native-menu").remove(),W.forEach((F,N)=>{F.scrollTop=rt[N]})},100),!0}return!1};ot(L.clientX,L.clientY,[{label:"Share conversation",action:()=>w("share")},{label:"Pin",action:()=>w("pin")},{label:"Rename",action:()=>w("rename")},{label:"Remove from Project",danger:!0,action:()=>_(l.id,v)},{label:"Delete",danger:!0,action:()=>{w("delete")||_(l.id,v)}}])}),u.appendChild(M),u.addEventListener("click",L=>{if(L.target.closest(".gcm-chat-menu-btn"))return;let w=J(l.id),G=w?.querySelector('[data-test-id="conversation"]')||w?.querySelector('[role="button"]')||w;G?(w&&(w.style.display=""),G.click(),setTimeout(()=>{w&&(w.style.display="none")},100)):Yt(l.id)}),h.appendChild(u)});m.appendChild(h),c.appendChild(m)}),requestAnimationFrame(Xt)};var St="gcm-move-to-project-item",Qt=t=>{if(t.querySelector(`#${St}`))return;let e=x(),o=Q(),n=b();if(!o)return;let c=t.querySelectorAll('[role="menuitem"], .mat-mdc-menu-item, button.mdc-list-item');if(c.length===0)return;let r=Array.from(c).map(C=>C.textContent?.toLowerCase()||"").join(" ");if(!(r.includes("delete")||r.includes("share")||r.includes("pin")||r.includes("rename")))return;let m=!!n[o.id]?.projectId,d=c[c.length-1],a=document.createElement("button");a.id=St,a.setAttribute("role","menuitem"),a.className="mat-mdc-menu-item mat-mdc-focus-indicator mdc-list-item gcm-move-item",a.style.cssText=`
    position: relative;
    padding: 0 16px;
    height: 48px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
    color: ${m?"#f28b82":"#e3e3e3"};
    background: transparent;
    border: none;
    width: 100%;
    text-align: left;
    font-family: inherit;
  `;let g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("width","20"),g.setAttribute("height","20"),g.style.fill=m?"#f28b82":"#e3e3e3",g.innerHTML='<path d="M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>';let y=document.createElement("span");if(y.textContent=m?"Remove from Project":"Move to Project",y.style.flex="1",a.appendChild(g),a.appendChild(y),m)a.addEventListener("click",C=>{C.stopPropagation(),_(o.id,v),document.body.click()}),a.addEventListener("mouseenter",()=>{a.style.background="rgba(255, 255, 255, 0.08)"}),a.addEventListener("mouseleave",()=>{a.style.background=""});else{let C=document.createElement("span");C.textContent="\u203A",C.style.cssText="font-size: 16px; color: #9aa0a6;",a.appendChild(C);let h=document.createElement("div");if(h.classList.add("gcm-native-submenu"),h.style.cssText=`
      position: fixed;
      background: #202124;
      border-radius: 4px;
      padding: 0;
      min-width: 160px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3), 0 4px 8px 3px rgba(0,0,0,0.15);
      display: none;
      z-index: 10002;
      font-family: "Google Sans", Roboto, sans-serif;
      overflow: hidden;
    `,e.length===0){let u=document.createElement("div");u.style.cssText="padding: 12px 16px; color: #9aa0a6; font-size: 14px;",u.textContent="No projects yet",h.appendChild(u)}else e.forEach(u=>{let p=document.createElement("div");p.style.cssText=`
          padding: 12px 16px;
          cursor: pointer;
          font-size: 14px;
          color: #e8eaed;
          font-family: "Google Sans", Roboto, sans-serif;
          transition: background 0.1s;
        `,p.textContent=u.name,p.addEventListener("mouseenter",()=>{p.style.background="rgba(255, 255, 255, 0.1)"}),p.addEventListener("mouseleave",()=>{p.style.background=""}),p.addEventListener("click",f=>{if(f.stopPropagation(),o){K(o.id,o.title,u.id,v),h.remove(),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape",keyCode:27,bubbles:!0}));let M=document.querySelector(".cdk-overlay-backdrop");M&&M.click(),document.querySelectorAll(".mat-mdc-menu-panel").forEach(L=>{L.remove()}),document.querySelectorAll(".cdk-overlay-pane").forEach(L=>{L.querySelector(".mat-mdc-menu-panel")&&L.remove()})}}),h.appendChild(p)});document.body.appendChild(h),a.addEventListener("mouseenter",()=>{a.style.background="rgba(255, 255, 255, 0.08)";let u=a.getBoundingClientRect();h.style.left=`${u.right}px`,h.style.top=`${u.top}px`,h.style.display="block";let p=h.getBoundingClientRect();p.right>window.innerWidth&&(h.style.left=`${u.left-p.width}px`),p.bottom>window.innerHeight&&(h.style.top=`${window.innerHeight-p.height-8}px`)}),a.addEventListener("mouseleave",u=>{let p=u.relatedTarget;h.contains(p)||(a.style.background="",h.style.display="none")}),h.addEventListener("mouseleave",()=>{a.style.background="",h.style.display="none"});let l=()=>{document.body.contains(t)||(h.remove(),document.removeEventListener("click",l))};setTimeout(()=>document.addEventListener("click",l),100)}d&&d.parentElement&&d.parentElement.insertBefore(a,d)},At=()=>{let t=["projects","chats","gemini","recent","starred","untitled"];document.addEventListener("click",e=>{let o=e.target.closest(".conversation-actions-menu-button")||e.target.closest('[data-test-id="actions-menu-button"]')||e.target.closest('button[aria-haspopup="menu"]');if(o){let n=o.closest(".conversation-items-container");if(n){let r=n.querySelector(".conversation-title")?.textContent?.trim()||"Untitled Chat",s=E(n),i=r&&!t.includes(r.toLowerCase());s&&i&&at({id:s,title:r})}}},!0)},Tt=()=>{new MutationObserver(e=>{for(let o of e)for(let n of o.addedNodes){if(n.nodeType!==Node.ELEMENT_NODE)continue;let r=n.classList?.contains("cdk-overlay-pane")?n.querySelector(".mat-mdc-menu-panel"):null,s=n.classList?.contains("mat-mdc-menu-panel"),i=r||(s?n:null);i&&Q()&&setTimeout(()=>Qt(i),50)}}).observe(document.body,{childList:!0,subtree:!0})};var B=new Set,kt=!1,Ht=null,Gt=()=>{let t=window.location.pathname.match(/\/gem\/([^/?]+)/);return t?t[1]:null},zt=t=>x().find(o=>o.gemId===t),qt=t=>t.querySelector(".conversation-title")?.textContent?.trim()||"Untitled Chat",te=()=>{kt||(document.querySelectorAll(".conversation-items-container").forEach(t=>{let e=E(t);e&&B.add(e)}),kt=!0)},_t=t=>{let e=E(t);if(!e)return;if(b()[e]){B.add(e);return}if(B.has(e))return;B.add(e);let n=Gt();if(!n)return;let c=zt(n);if(!c)return;let r=qt(t);setTimeout(()=>{let s=E(t)||e,i=qt(t)||r;K(s,i,c.id,Ht),B.add(s)},150)},Nt=t=>{Ht=t,setTimeout(te,1e3),new MutationObserver(o=>{let n=Gt();!n||!zt(n)||o.forEach(r=>{r.addedNodes.forEach(s=>{s.nodeType===Node.ELEMENT_NODE&&(s.classList?.contains("conversation-items-container")&&_t(s),s.querySelectorAll?.(".conversation-items-container").forEach(i=>{_t(i)}))})})}).observe(document.body,{childList:!0,subtree:!0})};var ee="1.2.0";console.log(`[GCM] Gemini Chat Manager v${ee} loaded`);var ne=()=>document.querySelector('conversations-list[data-test-id="all-conversations"]'),oe=async()=>{let t=["projects","chats","gemini","recent","starred","untitled","untitled chat"],e=$(),o=await it();P(o.projects);let n=pt(o.chatMappings),c=new Set(o.projects.map(m=>m.id)),r={};Object.entries(n).forEach(([m,d])=>{let a=d?.projectId&&c.has(d.projectId),g=d?.title&&!t.includes(d.title.toLowerCase());a&&g&&(r[m]=d)}),A(r),S(r),yt(),At(),Tt();let s=0,i=setInterval(()=>{s++;let m=ne();if((m||s>60)&&(clearInterval(i),m)){v();let d=null,a=(f,M)=>()=>{d&&clearTimeout(d),d=setTimeout(f,M)},g=!1,y=()=>{let f=document.getElementById("gcm-container");return f?f.matches(":hover"):!1},C=()=>{if(y()){if(g)return;g=!0;let f=()=>{if(!y()){g=!1,v();return}setTimeout(f,150)};setTimeout(f,150);return}g=!1,v()},h=a(()=>{tt()},300),l=a(()=>{C()},200);new MutationObserver(()=>{(!Pt()||!document.getElementById("gcm-container"))&&l(),h()}).observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{tt(),ht()},500),Nt(l),setInterval(()=>{ft()&&l()},1e4);let p=window.location.href;setInterval(()=>{window.location.href!==p&&(p=window.location.href,v())},200),setInterval(()=>{if(vt()){l();return}l()},3e3)}},200)};oe();})();
